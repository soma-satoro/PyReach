{% extends "wiki/base.html" %}
{% load static %}

{% block title %}{{ category.name }}{% endblock %}

{% block content %}
<div class="container">
    <!-- Category Header -->
    <div class="card" style="margin-bottom: 2rem;">
        <div class="card-header">
            <div class="flex-between">
                <div>
                    <h1 style="margin: 0; display: flex; align-items: center; gap: 1rem;">
                        <i class="fas {{ category.icon|default:'fa-folder' }}" style="color: var(--color-accent-purple);"></i>
                        {{ category.name }}
                    </h1>
                    {% if category.parent %}
                    <p class="text-muted" style="margin-top: 0.5rem;">
                        <a href="{% url 'wiki:category' category.parent.slug %}">
                            <i class="fas fa-arrow-left"></i> {{ category.parent.name }}
                        </a>
                    </p>
                    {% endif %}
                </div>
                {% if user.is_staff or perms.wiki.can_edit_wiki %}
                <div class="flex gap-2">
                    <a href="{% url 'wiki:page_create' %}?category={{ category.id }}" class="btn btn-primary btn-sm">
                        <i class="fas fa-plus"></i> New Page
                    </a>
                    <a href="{% url 'wiki:category_edit' category.slug %}" class="btn btn-secondary btn-sm">
                        <i class="fas fa-edit"></i> Edit Category
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
        {% if category.description %}
        <div class="card-body">
            <p style="font-family: var(--font-serif); font-size: 1.1rem; margin: 0;">
                {{ category.description }}
            </p>
        </div>
        {% endif %}
    </div>

    <!-- Subcategories -->
    {% if subcategories %}
    <section style="margin-bottom: 3rem;">
        <h2><i class="fas fa-layer-group"></i> Subcategories</h2>
        <div class="grid grid-3">
            {% for subcat in subcategories %}
            <a href="{% url 'wiki:category' subcat.slug %}" class="card" style="text-decoration: none;">
                <div style="text-align: center;">
                    <div style="font-size: 2.5rem; color: var(--color-accent-purple); margin-bottom: 1rem;">
                        <i class="fas {{ subcat.icon|default:'fa-folder' }}"></i>
                    </div>
                    <h3 class="card-title" style="font-size: 1.3rem;">{{ subcat.name }}</h3>
                    {% if subcat.description %}
                    <p class="text-muted" style="font-size: 0.95rem;">{{ subcat.description|truncatewords:15 }}</p>
                    {% endif %}
                    <div class="mt-2">
                        <span class="badge badge-gold">{{ subcat.pages.count }} page{{ subcat.pages.count|pluralize }}</span>
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- Pages in this Category -->
    <section>
        <h2><i class="fas fa-file-alt"></i> Pages ({{ pages.count }})</h2>
        
        {% if pages %}
        <div class="grid grid-2">
            {% for page in pages %}
            <div class="card" data-tags="{% for tag in page.get_tags_list %}{{ tag }} {% endfor %}">
                <div class="card-header">
                    <h3 class="card-title">
                        <a href="{% url 'wiki:page' page.slug %}">{{ page.title }}</a>
                    </h3>
                    {% if page.staff_only %}
                    <span class="badge badge-danger">
                        <i class="fas fa-shield-alt"></i> Staff Only
                    </span>
                    {% endif %}
                    {% if page.featured %}
                    <span class="badge badge-gold">
                        <i class="fas fa-star"></i> Featured
                    </span>
                    {% endif %}
                </div>
                {% if page.summary %}
                <div class="card-body">
                    <p>{{ page.summary|truncatewords:25 }}</p>
                </div>
                {% endif %}
                <div class="card-footer">
                    <div class="flex gap-3">
                        <span><i class="fas fa-eye"></i> {{ page.view_count }}</span>
                        <span><i class="fas fa-calendar"></i> {{ page.updated_at|date:"M d" }}</span>
                    </div>
                    <a href="{% url 'wiki:page' page.slug %}" class="btn btn-sm btn-secondary">
                        Read <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="card" style="text-align: center; padding: 3rem;">
            <i class="fas fa-file-alt" style="font-size: 4rem; color: var(--color-text-muted); margin-bottom: 1rem;"></i>
            <p class="text-muted">No pages in this category yet.</p>
            {% if user.is_staff or perms.wiki.can_edit_wiki %}
            <a href="{% url 'wiki:page_create' %}?category={{ category.id }}" class="btn btn-primary mt-2">
                <i class="fas fa-plus"></i> Create First Page
            </a>
            {% endif %}
        </div>
        {% endif %}
    </section>

    <!-- Back Navigation -->
    <div class="text-center" style="margin-top: 3rem;">
        <a href="{% url 'wiki:index' %}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to Wiki Home
        </a>
    </div>
</div>
{% endblock %}

